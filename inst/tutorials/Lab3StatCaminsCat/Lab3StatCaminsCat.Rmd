---
title: "Lab3-Regressi贸 lineal simple complerta "
subtitle: "
<div id='logo-nom-subtitle' style='text-align:center;'>
  <img src='www/logoUPC.png' style='height:50px; display:block; margin:0 auto 5px auto;'>
  <p style='margin:0; font-weight:bold; color:#0055A4 !important; font-size:16px;'>Maribel Ortego</p>
</div>"
author: "Maribel Ortego"
date: "`r format(Sys.time(), '%Y %B %d')`"

output:
  learnr::tutorial:
    progressive: false
    theme:
      bslib: true
      bootswatch: minty
    css:
      - "css/styles.css"
      - "css/hero-image-css-v2.css"
    includes:
      in_header: "www/hero-image-PiE.html"
    number_sections: TRUE
    toc: true
    toc_depth: 4
    toc_float: true

runtime: shiny_prerendered
bibliography: geyser.bib 
---

```{r, label="generaloptions", include=FALSE}
# Configuraci贸 general del tutorial
library(learnr)
knitr::opts_chunk$set(
  echo = TRUE,
  fig.width = 6,
  out.width = "50%",
  fig.align = "center",
  fig.caption = TRUE
)
```

#  Introducci贸
En aquest Lab2 treballarem amb el conjunt dades  **Geyser**, realitzant una anlisi descriptiva univariant i bivariada, aix铆 com una aproximaci贸 a la regressi贸 lineal i la definici贸 de factors.

::: {.infobox .caution data-latex="{caution}"}
**Recorda establir correctament el directori de treball** abans de comen莽ar a llegir les dades.
:::

## El context: Old Faithful

Old Faithful 茅s un geyser situat al Parc Nacional de Yellowstone (Wyoming, Estats Units), una gran atracci贸 tur铆stica.
A @DenPre1987 es presenten les dades: "Des del dia 1 d'agost al dia 8 d'agost de 1978, un grup
de rangers (policia del parc) i naturalistes van enregistrar la durada de l'erupci贸 i l'int猫rval fins
a la seg眉ent erupci贸 (en minuts) de les erupcions del geyser Old Faithful, entre les 6 del mat铆 i mitjanit.
La intenci贸 de l'estudi era predir l'hora de la seg眉ent erupci贸, per tal de posar-la al cartells del Centre
de Visitants, de manera que els visitants del Parc de Yellowstone pogu茅ssin administrar b茅 el seu temps."


### Estudi de la relaci贸 entre Durada i Int猫rval (continuaci贸):

Aquestes dades ja van ser introdu茂des al Lab2. Comen莽arem aquest Lab3 repetint algunes de les passes que ja vam fer. Entre d'altres, haur铆eu de poder:

(a) Representar el diagrama de dispersi贸 de Int猫rval respecte Durada en l'escala transformada (log).

(b) Calcular la covarian莽a i correlaci贸 mostrals.

Una vegada realitzades aquestes primeres passes, introdu茂rem com:

(c) Estimar la recta de regressi贸 de m铆nims quadrats de l'Int猫rval respecte la durada, en l'escala adequada (log). Realitzeu l'anlisi complert: diagn貌stic d'hip貌tesis i interpretaci贸 de resultats. (Veure Secci贸 [Interpretaci贸 complerta del model: pas a pas][Interpretaci贸 complerta del model: pas a pas]).

A continuaci贸, farem l'estudi de la relaci贸 entre Durada i Int猫rval i complicarem el model. Veurem com:

(d) Definir un factor que divideixi les durades en curtes i llargues. Preneu com a valor de refer猫ncia els 3 minuts de durada, o els corresponents en logdurada.
(e) Representar el diagrama de caixa dels logint猫rvals entre erupcions segons les dues categories de logdurada definides.
(f)  Ajustar la recta de regressi贸 que assigna diferents ordenades a l'origen a les dues categories de logdurada. Realitzeu l'anlisi complert: diagn貌stic d'hip貌tesis i interpretaci贸 de resultats. (Veure Secci贸 [Interpretaci贸 complerta del model: pas a pas][Interpretaci贸 complerta del model: pas a pas]).
(g)  Ajustar la recta de regressi贸 que assigna diferents ordenades a l'origen i diferents pendents a les dues categories de logdurada. Realitzeu l'anlisi complert: diagn貌stic d'hip貌tesis i interpretaci贸 de resultats. (Veure Secci贸 [Interpretaci贸 complerta del model: pas a pas][Interpretaci贸 complerta del model: pas a pas]).

Som-hi. Comencem el Lab3.

## El model de regressi贸

::: {.infobox .caution data-latex="{caution}"}
**s imprescindible** haver llegit la secci贸 de Regressi贸 lineal simple del document

**Introducci贸_Regressio_Lineal-GEC2020-2024-2025-s.pdf**

:::

##  Llibreries i lectura de dades

Una vegada establert el directori de treball, comen莽arem cridant les llibreries que necessitem a la sessi贸. A Lab1 es va fer la instal路laci贸 de la llibreria `car`. Si per  algun motiu no la tens instal路lada, cal que revisis els continguts del Lab1. 

```{r llibreries}
library(car)
library(nnet)
```

::: {.infobox .circle data-latex="{circle}"}

***AVS!***

Obriu el fitxer **"DadesGeyser.csv"** utilitzant el Bloc de notes.  
Observeu el format del fitxer: com estan separades les columnes? amb tabulador,coma, punt i coma, espai?; Estan inclosos els noms de les variables? Hi ha files inicials amb comentaris?
:::

Llegim el conjunt de dades, tenint en compte la seva estructura, i li donem un nom. 


::: {.infobox .caution data-latex="{caution}"}
***IMPORTANT***: R diferencia maj煤scules i min煤scules: *Dades* 茅s diferent a *dades*.
:::

```{r lectura_dades, echo=TRUE}
dadesgeyser <- read.table("DadesGeyser.csv",
             header=TRUE, sep=";", na.strings="NA", dec=".", strip.white=TRUE)
```
Donat que les variables Durada i Int猫rval s贸n positives i tenen escala relativa, generem dues noves variables. Aplicarem el logaritme (natural, neperi) i guardarem les variables al dataframe.

```{r}
dadesgeyser$logdurada <- with(dadesgeyser, log(Durada))
dadesgeyser$loginterval <- with(dadesgeyser, log(Interval))
```

# Introdu茂m un factor

Els factors ens ajuden a afinar la descripci贸 de les dades. En ocasions ja estan inclosos entre les variables. En d'altres ocasions, la primera observaci贸 de les dades ens permet definir-ne de nous.

## Definim un factor

Observant el diagrama de dispersi贸 de les dues variables hem vist que hi ha dos n煤vols de punts. Sembla que les durades curtes es relacionen amb int猫rvals curts i les durades llargues amb int猫rvals llargs (amb una mica de soroll pel mig). Aprofitem aquesta observaci贸 per a definir una nova variable, que ser el factor "Durada curta".

```{r, fig.cap="Scatterplot Int猫rval vs Durada"}
car::scatterplot(Interval~Durada, smooth=FALSE, regLine=FALSE, boxplots=FALSE, data=dadesgeyser)
```

Fem-ho per parts: 1) definim la variable indicador durada. Seleccionem les observacions amb una durada inferior a un valor donat. Aquesta 茅s una condici贸 l貌gica, que guardem com a num猫rica i per si de cas, li donem forma de vector. Els 1 seran Int猫rvals curts i els 0 seran int猫rvals llargs. 2) Afegim aquest vector al nostre dataframe i 3) Li diem a R que aquest vector num猫ric de 0 i 1 en realitat 茅s una variable qualitativa (factor), i que pot substitu茂r el 0 i 1 per l'etiqueta corresponent:

::: {.infobox .caution data-latex="{caution}"}
En les etiquetes 茅s important respectar l'ordre. 0 correspon a llarg i 1 a curt
:::

```{r}
indicadordurada <- as.vector((as.numeric(dadesgeyser[,"Durada"]>3)))

dadesgeyser <- cbind(dadesgeyser, indicadordurada)

dadesgeyser$indicadordurada <- factor(dadesgeyser$indicadordurada, labels=c('Durada curta','Durada llarga'))

```
### Exercici:F茅u un summary del factor indicadordurada
```{r exercici_summary, exercise=TRUE}
```

#  Estudi de la relaci贸 entre variables

El m贸n no 茅s univariant. Abans d'estudiar les variables multivariants, podem descriure les relacions dos a dos entre variables. 

## Scatterplots

El diagrama de dispersi贸 ens permet visualitzar la relaci贸 bivariant entre variables.

La funci贸 `scatterplot` de `car` ens permet realitzar aquesta representaci贸. Representarem directament la versi贸 sense l铆nies extra i amb escala complerta:

```{r, fig.cap="Modificaci贸 dels eixos del diagrama de dispersi贸 per loginterval i logdurada"}
car::scatterplot(loginterval~logdurada, smooth=FALSE, regLine=FALSE, boxplots=FALSE, data=dadesgeyser, xlim=c(0,1), ylim=c(0,4.5))
```

### Exercici: Quin eren els valors mxims i m铆nims de les variables? Cal modificar quelcom de la grfica? Escriu el codi corresponent.
```{r exercici_valorsmaxmin, exercise=TRUE}

```

## Mesura de la relaci贸 lineal

Recordem que al Lab anterior vam calcular la covarincia i la correlaci贸 de les dues variables.

Recordem que el coeficient de correlaci贸 lineal de Pearson mesura la depend猫ncia _lineal_ de les variables. Ep! Cal anar en compte, perqu猫 al llenguatge diari utilitzem correlaci贸 com a sin貌nim de depend猫ncia. El coeficient de correlaci贸 lineal de Pearson 茅s una versi贸 normalitzada de la covarincia, que facilita la seva interpretaci贸 :

\[
r_{XY}=\frac{Cov(X,Y)}{\sqrt{Var[X]}\sqrt{Var[Y]}}  \ .
\]

Recordem que el coeficient pren valors entre [-1,1] i que si dues variables tenen correlaci贸 0, diem que s贸n *incorrelacionades*.

Al diagrama de dispersi贸 hem observat una certa depend猫ncia lineal entre les variables, per貌 no perfecta. Calculem el corresponent coeficient de correlaci贸 de Pearson:

```{r}
cor(dadesgeyser[,c("logdurada","loginterval")], use="complete")
```

Observem que obtenim un valor de correlaci贸 mig-alt, que correspon al que hav铆em observat al grfic.

Existeixen d'altres coeficients de correlaci贸 (Kendall, Spearman), que mesuren depend猫ncies m茅s generals. No els farem servir de moment.

# Model de  Regressi贸 lineal simple (m铆nims quadrats)

Volem dibuixar la recta de regressi贸 lineal de Y respecte a X utilitzant el m猫tode de m铆nims quadrats, $$  Y= \beta_0 + \beta_1 X $$.

## Els coeficients per m铆nims quadrats 
Podem obtenir l'expressi贸 anal铆tica dels coeficients $\beta_0$ (ordenada a l'origen) i $\beta_1$ (pendent) de la recta estimats amb el m猫tode de m铆nims quadrats:

\[ 
\beta_1= \frac{Cov(X,Y)}{Var[X]}  
\]
\[ 
\beta_0= \bar{y}- \beta_1 \bar{x}
\]

Abans de calcular els coeficients que corresponen a les dades disponibles, calculem els valors intermitjos que necessitem:

```{r}
mean(dadesgeyser$logdurada)
mean(dadesgeyser$loginterval)
var(dadesgeyser$logdurada)
var(dadesgeyser$loginterval)
cov(dadesgeyser$logdurada, dadesgeyser$loginterval)
```

### Exercici: Calcula el pendent i l'ordenada a l'origen de la recta de regressi贸
```{r exercici_pendentiordenada, exercise=TRUE}
 
```

### Exercici: Representa l'scatterplot de les dues variables i afegeix la recta de regressi贸 utilitzant la instrucci贸 `abline`.
```{r exercici_regressio, exercise=TRUE}
 
```

##  Model lineal inicial i validaci贸

El model de regressi贸 lineal simple complert des del punt de vista estad铆stic precisa d'una s猫rie d'hip貌tesis que ens permeten valorar si l'ajust 茅s adequat i la qualitat de l'ajust lineal.

Les hip貌tesis del model lineal de m铆nims quadrats s'estableixen sobre els residus del model, 茅s a dir, sobre la difer猫ncia entre les observacions de la variable predita i els valors predits pel model.

s imprescindible valorar si es compleixen les hip貌tesis d'aquest model. En els primers laboratoris realitzarem aquesta valoraci贸 grficament. M茅s endavant ho completarem amb els anomenats contrastos d'hip貌tesis.

El pas a pas ser sempre el mateix: 1) Crida del model; 2) Verificaci贸 de les hip貌tesis del model; 3) Si les hip貌tesis es compleixen, interpretaci贸 del `summary` del model i 4) Nova iteraci贸 si es requereix algun canvi

### Interpretaci贸 complerta del model: pas a pas 

El model estad铆stic de regressi贸 lineal (tant simple com m煤ltiple) es basa en les hip貌tesis sobre els residus. La validaci贸 d'aquestes hip貌tesis 茅s **imprescindible**. Si les hip貌tesis no es compleixen, la interpretaci贸 posterior sobre el model no t茅 sentit. 

Pas a pas:

(1) Genereu el model de regressi贸 lineal m煤ltiple usant R.
(2) Comproveu si es compleixen les hip貌tesis del model, la seva validesa i la qualitat de l'ajust:
   
      (a) Si hi ha dues o m茅s variables predictores, comproveu si existeix colinealitat de les variables predictores. La colinealitat influeix en els contrastos d'hip貌tesis posteriors. En cas de colinealitat, cal aplicar m猫todes que l'evitin abans de continuar amb el proc茅s d'ajust del model.
      (b)	Comproveu les hip貌tesis del model: Residus centrats, incorrelacionats  homocedstics (amb la mateixa varian莽a) i amb distribuci贸 normal. Podem realitzar la comprovaci贸 visualment mitjan莽ant les grfiques de diagn貌stic del model. En cas de dubte, caldr complementar amb els contrastos d'hip貌tesi corresponents a cada hip貌tesis del model. (En veurem alguns m茅s endavant). Si no es compleix alguna de les hip貌tesis, caldr tenir-ho en compte de cara a les interpretacions posteriors. (Hi profunditzarem m茅s endavant).
      (c)	Verifiqueu si el model lineal t茅 sentit. Contrast $F$.
      (d) Verifiqueu si algun dels coeficients del model pot ser nul mitjan莽ant els contrastos $t$. Si 茅s el cas, torneu a general el model de regressi贸 sense aquesta / aquestes variables.
      (e)	Verifiqueu la qualitat del model. Taula ANOVA del model. Coeficient de determinaci贸.
   
(3)	Escriviu l'equaci贸 del model lineal resultant, amb els coeficients estimats. Interpreteu el model.


::: {.infobox .caution data-latex="{caution}"}
Qu猫 passa si no es compleix alguna de les hip貌tesis del model? Doncs que no es poden interpretar els resultats del summary amb confian莽a. En parlarem en un altre lab.

Si la hip貌tesis que no es compleix 茅s la de normalitat, no podem interpretar correctament els $p$-valors intermitjos, per貌 s铆 els que s贸n molt grans o molt petits. s a dir, si el $p$-valor 茅s 0.9, clarament no podem rebutjar la $H_0$; si el $p$-valor 茅s 1*e-26, clarament rebutjarem $H_0$. Valors prop de 0.05 no els podrem decidir, perqu猫 la distribuci贸 de l'estad铆stic no 茅s la suposada.
:::


## El model de Regressi贸 lineal simple per OldFaithful

Volem predir el logintervar a partir de la logdurada, amb un model de regressi贸 lineal simple estimat per m铆nins quadrats:

```{r, LM0}
LinearModel.0 <- lm(loginterval ~ logdurada, data=dadesgeyser)
```

Representem conjuntament els quatre grfics de diagn貌stic que ens proporciona R:

```{r, fig.cap="Grfics de diagn貌stic del model de regressi贸 simple loginterval ~ logdurada"}
par(mfrow=c(2,2))
  plot(LinearModel.0)
par(mfrow=c(1,1))
```

Els interpretarem millor si els visualitzem un a un:

### Grfic 1: residus vs predits

Amb el grfic de  residus vs valors predits comprovarem visualment tres de les hipotesis: 1) residus centrats; 2) residus homocedstics (igual varincia) i 3) residus incorrelacionats:

```{r, graf1, fig.cap="Grfics de diagn貌stic del model de regressi贸 simple loginterval ~ logdurada"}
plot(LinearModel.0, which=1)
```

Observant el grfic, no podem rebutjar que els residus siguin centrats, homocedstics i incorrelacionats.

### Grfic2: Normalitat
```{r, graf2, fig.cap="Grfics de diagn貌stic del model de regressi贸 simple loginterval ~ logdurada"}
plot(LinearModel.0, which=2)
```

El `qqplot` 茅s un grfic que ens permet valorar si la distribuci贸  de les dades, els residus del model en aquest cas, 茅s similar a la distribuci贸 de refer猫ncia, en aquest cas la distribuci贸 normal. El qqplot representa la funci贸 de distribuci贸 de refer猫ncia reescalada de manera que es converteix en una recta, i s'aplica la mateixa transformaci贸 a la funci贸 de distribuci贸 mostral dels residus. Si els punts de la funci贸 de distribuci贸 mostral segueixen la recta, direm que no podem rebutjar que la distribuci贸 de la variable 茅s la de refer猫ncia. En el nostre cas, que els residus tenen una distribuci贸 normal.

El grfic proporcionat per defecte es pot millorar afegint una banda de confian莽a. Aquest grfic millorat es troba a la llibreria `car`.

Quan generem el model lineal es generen quantitats d'inter猫s a les que podem accedir: valors predits, coeficients, residus, entre d'altres. Podem treballar amb aquesta variable normalment. Per exemple, podem representar el seu histograma

```{r, fig.cap="Histograma dels residus del model simple"}
LinearModel.0$residuals
hist(LinearModel.0$residuals)
```

O la funci贸 de distribuci贸 emp铆rica dels  residus, la que reescalem per a generar el qqplot:

```{r, fig.cap="Funci贸 de distribuci贸 emp铆rica dels residus del model simple"}
plot(ecdf(LinearModel.0$residuals))
```

### Exercici:
```{r  residus-quiz, echo=FALSE}
quiz(
question("Els residus",
    answer("Tenen una mitjana mostral aproximadament 0", correct = TRUE),
    answer("Presenten un histograma sim猫tric", correct = TRUE),
    answer("El percentil 80 茅s aproximadament 0.1", correct = TRUE),
    answer("Totes les opcions anteriors s贸n correctes", correct = TRUE)
    )
   )    
```

Representarem el `qqPlot` dels residus. La banda de confian莽a que ens permet valorar si els punts allunyats de la refer猫ncia s贸n realment molt llunyans i aleshores rebutjar el model de refer猫ncia:

```{r, graf3b, fig.cap="qqPlot dels residus"}
car::qqPlot(LinearModel.0$residuals)
```

Observant el grfic, no podem rebutjar que la distribuci贸 dels residus sigui normal.

### Grfic3: Residus vs predits, reescalat

Aquest grfic complementa el grfic de residus vs valors predits. El reescalat de l'eix de residus permet visualitzar millor (l'abs猫ncia) incorrelaci贸 que al grfic 1.

```{r, graf3, fig.cap="Grfics de diagn貌stic del model de regressi贸 simple loginterval ~ logdurada"}
plot(LinearModel.0, which=3)
```

### Grfic4: Leverage

Aquest grfic no forma part estrictament de la comprovaci贸 de les hip貌tesis del model. Probablement es va afegir als grfics per defecte per a completar els quatre, per貌 resulta d'utilitat. verifiquem els punts influents, els punts *palanca*, en angl猫s *leverage points* i mesurem la seva influ猫ncia. En general, no s'aconsella eliminar els punts influents, per貌 cal ser conscients que ho s贸n per a fer les interpretacions posteriors. Considerarem influents aquells valors que presenten una distncia de Cook de 0.5 o superior.

```{r, graf4,fig.cap="Grfics de diagn貌stic del model de regressi贸 simple loginterval ~ logdurada"}
plot(LinearModel.0, which=4)
```

Veient el grfic, descartem que hi hagi valors influents que afectin el model.

### El resum del model
Un cop verificades les hip貌tesis del model, podem procedir a interpretar el resum del model:

```{r, summLM0}
summary(LinearModel.0)
```

Cal observar

(1) Contrast F:  cal verificar el valor del $p$-valor. En aquest cas, donat que el $p$-valor 茅s molt petit, rebutgem la hip貌tesis de "tots els coeficients del model excepte $\beta_0$ s贸n nuls alhora". Per tant, *el model lineal t茅 sentit*.

(2) Contrastos $t$: cal verificar el valor del p-valor del test de cadascun dels coeficients. En aquest cas, donat que el $p$-valor 茅s petit es rebutja que $\beta_0$ sigui nul i tamb茅 es rebutja que $\beta_1$ sigui nul. Mantenim els dos coeficients al model.

(3) Coeficient de determinaci贸: $R^2 \in [0,1]$. Com m茅s proper a 1, millor 茅s l'ajust lineal del model. Hem obtingut un ajust bo.

Observaci贸: En el cas del model de regressi贸 lineal simple, el coeficient de determinaci贸 茅s el quadrat del coeficient de correlaci贸 entre les varibles. Aix貌 no es compleix per models de regressi贸 lineal m煤ltiple.

### Exercici:
```{r  summaryM0-quiz, echo=FALSE}
quiz(
question("Al summary del Model0",
    answer("El $p$-valor del contrast F 茅s 2.2e-16", correct = TRUE),
    answer("El coeficient de determinaci贸 茅s 0.7948", correct = TRUE),
    answer("Rebutgem que el coeficient $\beta_0$ sigui nul", correct = TRUE),
    answer("Totes les opcions anteriors s贸n correctes", correct = TRUE)
    )
   )    
```

### Visualitzaci贸 del model estimat

Podem representar la recta de regressi贸 lineal simple estimada sobre de l'`scatterplot`. La instrucci贸 `abline` ens permet cridar directament el model, o b茅 podr铆em proporcionar els parmetres:

```{r, fig.cap="Recta de regressi贸 ajustada sobre scatterplot loginterval ~ logdurada"}
scatterplot(loginterval~logdurada, xlim=c(0,1.8), ylim=c(0,5), regLine=FALSE, smooth=FALSE, boxplots=FALSE, data=dadesgeyser)
abline(LinearModel.0, col=4)
```

#  Model de regressi贸 afegint un factor

En les representacions univariades vam veure que es podien visualitzar dos grups, corresponents a durades/int猫rvals curts i llargs. Hem definit un factor per a representar aquesta caracter铆stica. Ara utilitzarem el factor per a millorar el model de regressi贸 lineal.

Veiem que el logint猫rval t茅 caracter铆stiques diferents segons la durada:

```{r, fig.cap="Boxplot per a loginterval segons els dos grups definits per indicadordurada"}
boxplot(loginterval~indicadordurada, ylab='loginterval', xlab='indDurada', data=dadesgeyser)
```

## Model de regressi贸 amb factor. Interacci贸 simple

Establim un nou model de regressi贸 lineal. Hi introdu茂m el factor, de manera que es podria considerar com a m煤ltiple (m茅s d'una variable predictora). Observem que introdu茂m l'indicador amb un + . Aix铆 l'indicador nom茅s afecta $\beta_0$, i per tant tindrem un $\beta_0$ per a cadascun dels nivells del factor (en aquest cas, un per les durades curtes i un altre per les durades llargues). Aix貌 correspon a generar dues rectes de regressi贸 paral路leles, amb diferents ordenades a l'origen.

```{r, LM1}
LinearModel.1 <- lm(loginterval ~ logdurada + indicadordurada, data=dadesgeyser)
```

```{r, fig.cap="Grfics de diagn貌stic del model amb variable indicadora"}
par(mfrow=c(2,2))
plot(LinearModel.1)
par(mfrow=c(1,1))
```

```{r, summaryLM1}
summary(LinearModel.1)
```

::: {.infobox .caution data-latex="{caution}"}
Ep! La sortida dels parmetres estimats 茅s heretada de programes m茅s antics i 茅s una mica embolicada.
El model estimat 茅s:
\[
loginterval =  \beta_{0_{ref}}+ \Delta \beta_{0_{altra}}+ \beta_{1}* logdurada
\]

A la sortida, el valor de l'intercept correspon al $\beta_{0_{ref}}$, l'ordenada a l'origen de la categoria de refer猫ncia, que ser la primera per ordre alfab猫tic o b茅 la de n煤mero m茅s baix si hem codificat amb n煤meros.  

El valor $\beta_{0_{altra}}$ en realitat 茅s el canvi $\Delta \beta_{0_{altra}}$, increment o decrement de $\beta_{0_{ref}}$ pel fet d'estar a l'altre nivell del factor. s a dir,
$\beta_{0_{altra}}=\beta_{0_{ref}}+\Delta \beta_{0_{altra}}$.
:::

### Exercici:
```{r  summaryM1-quiz, echo=FALSE}
quiz(
question("Al summary del Model1",
    answer("El $p$-valor del contrast F 茅s 2.2e-16", correct = TRUE),
    answer("El coeficient de determinaci贸 del Model1 茅s lleugerament superior al del Model0", correct = TRUE),
    answer("Rebutgem que el coeficient $\beta_0$ sigui nul", correct = TRUE),
    answer("Totes les opcions anteriors s贸n correctes", correct = TRUE)
    )
   )    
```


Representem l'`scatterplot` amb les rectes de regressi贸 ajustades pels dos models:
```{r, fig.cap="Scatterplot amb regressions per grups definits per indicadordurada"}
scatterplot(loginterval~logdurada | indicadordurada, regLine=FALSE, smooth=FALSE, boxplots=FALSE, by.groups=TRUE, data=dadesgeyser)
abline(LinearModel.0, col=1)
abline(a=LinearModel.1$coeff[1], b=LinearModel.1$coeff[2], col=4)
abline(a=LinearModel.1$coeff[1]+LinearModel.1$coeff[3], b=LinearModel.1$coeff[2], col=2)
```

##  Model amb interacci贸 completa 

El model lineal m茅s complex que podem generar amb una variable predictora i un factor 茅s el que inclou la interacci贸 complerta. 

Observem que introdu茂m l'indicador amb un * . Aix铆 l'indicador afecta $\beta_0$, i $\beta_1$ i per tant tindrem un $\beta_0$ per a cadascun dels nivells del factor (en aquest cas, un per les durades curtes i un altre per les durades llargues) i anlogament per $\beta_1$. Aix貌 correspon a generar dues rectes de regressi贸 amb diferents ordenades a l'origen i diferents pendents.

```{r, LM2}
LinearModel.2 <- lm(loginterval ~ logdurada * indicadordurada, data=dadesgeyser)
```

```{r, fig.cap="Grfics de diagn貌stic del model amb interacci贸 logdurada * indicadordurada"}
par(mfrow=c(2,2))
plot(LinearModel.2)
par(mfrow=c(1,1))
```

```{r, sumLM2}
summary(LinearModel.2)
```

::: {.infobox .caution data-latex="{caution}"}
Ep! La sortida dels parmetres estimats segueix la l貌gica anterior. El model estimat 茅s:
\[
loginterval =  \beta_{0_{ref}}+ \Delta \beta_{0_{altra(}}+ (\beta_{1_{ref}}+ \Delta \beta_{1_{altra}})* logdurada
\]

A la sortida, el valor de l'intercept correspon al $\beta_{0_{ref}}$, l'ordenada a l'origen de la categoria de refer猫ncia, que ser la primera per ordre alfab猫tic o b茅 la de n煤mero m茅s baix si hem codificat amb n煤meros. (Per a l'indicadordurada, el 0, durada curta, ser el valor de refer猫ncia) 

El valor $\beta_{0_{altra}}$ en realitat 茅s el canvi $\Delta \beta_{0_{altra}}$, increment o decrement de $\beta_{0_{ref}}$ pel fet d'estar a l'altre nivell del factor. s a dir,
$\beta_{0_{altra}}=\beta_{0_{ref}}+\Delta \beta_{0_{altra}}$. 
Per $\beta_{1}$ tenim una situaci贸 similar.
:::

### Exercici:
```{r  summaryM2-quiz, echo=FALSE}
quiz(
question("Al summary del Model2",
    answer("El $p$-valor del contrast F 茅s 2.2e-16", correct = TRUE),
    answer("El coeficient de determinaci贸 del Model2 茅s lleugerament superior al del Model1", correct = TRUE),
    answer("No podem rebutjar que els increments de $beta_0$ i $beta_1$ per a les durades llargues siguin nuls", correct = TRUE),
    answer("Totes les opcions anteriors s贸n correctes", correct = TRUE)
    )
   )    
```


Representem l'`scatterplot` amb les rectes de regressi贸 ajustades pels tres models:
```{r, fig.cap="Scatterplot amb regressions per grups definits per indicadordurada"}
scatterplot(loginterval~logdurada | indicadordurada, regLine=FALSE, smooth=FALSE, boxplots=FALSE, by.groups=TRUE, data=dadesgeyser)
abline(LinearModel.0, col=1)
abline(a=LinearModel.1$coeff[1], b=LinearModel.1$coeff[2], col=4)
abline(a=LinearModel.1$coeff[1]+LinearModel.1$coeff[3], b=LinearModel.1$coeff[2], col=2)
abline(a=LinearModel.2$coeff[1], b=LinearModel.2$coeff[2], col=5)
abline(a=LinearModel.2$coeff[1]+LinearModel.2$coeff[3], b=LinearModel.2$coeff[2]+LinearModel.2$coeff[4], col=3)
```

::: {.infobox .circle data-latex="{circle}"}
Podr铆em millorar la representaci贸 canviat els parmetres `lty` (tipus de tra莽), `lwd` (gruix del tra莽) de les representacions de les rectes de regressi贸. Ja vam veure alguns d'aquests arguments a labs anteriors.
:::

Si no necessitem comparar models visualment, podem utilitzar l'`scatterplot` condicionat pel factor:

```{r, fig.cap="Relaci贸 entre logdurada i loginterval amb interacci贸 per grups"}
scatterplot(loginterval~logdurada | indicadordurada, smooth=FALSE, boxplots=FALSE, by.groups=TRUE, data=dadesgeyser)
```

##  Predicci贸

Amb freq眉猫ncia voldrem utilitzar el model ajustat per a realitzar prediccions. Caldr generar un data frame amb la mateixa estructura que el df original, que contingui les observacions per a les que volem obtenir les prediccions. Obtindrem la predicci贸 amb la instrucci贸 `predict`

```{r}
valref<- c(2, 3) #tenim dos valors de refer猫ncia 
logdurades<-log(valref)
indicadordurades<-c('Durada curta', 'Durada curta')

valpred <- data.frame(logdurada=logdurades, indicadordurada=indicadordurades)
logintervalPreditLM <- predict(LinearModel.2, valpred)
IntervalPreditLM<-exp(logintervalPreditLM )
prediccio <- data.frame(valref,valpred, logintervalPreditLM, IntervalPreditLM )
prediccio
```

# Conclusi贸 {-}

Amb aquest apartat hem acabat lanlisi descriptiva i la introducci贸 al model de regressi贸 lineal simple complert amb les dades d'Old Faithful

# References

<div id="refs"></div>

#  About / Canvis {-}

Material creat per M. Ortego per les Assignatures de l'mbit estad铆stic de l' ETSECCPB - UPC.

Versi贸 1.0

#  Cr猫dits {-}

<a href="https://www.flaticon.com/free-icons/travel" title="travel icons">Travel icons created by IconBaandar - Flaticon</a>

<a href="https://www.flaticon.com/free-icons/alert" title="alert icons">Alert icons created by Creatype - Flaticon</a>

<a href="https://www.flaticon.com/free-icons/find" title="find icons">Find icons created by hqrloveq - Flaticon</a>

<a href="https://www.flaticon.com/free-icons/eye" title="eye icons">Eye icons created by Freepik - Flaticon</a>